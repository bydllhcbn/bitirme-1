<div class="row mt-3">

    <div class="col-md-12 mt-2">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><a href="/" aria-label="Previous">
                    <span aria-hidden="true">ğŸ ˜  </span>
                </a>'{{board.title}}' AdlÄ± Panoya Ait Ä°lanlar</h5>
                <div class="list-group ">
                    {{#each ads}}
                        <a href="/ad/edit/{{this.id}}" class="list-group-item list-group-item-action ">
                            <b>{{this.id}}</b>
                            {{this.title}}
                            <span class="badge badge-primary badge-pill">{{this.price}} TL</span>
                            <span class="badge badge-warning badge-pill">{{this.location}}</span>
                        </a>
                    {{/each}}
                </div>
                <a href="/ad/add/{{boardId}}" class="btn btn-primary mt-2">Panoya Yeni Ä°lan Ekle</a>
            </div>
        </div>
    </div>

    <div class="col-md-12 mt-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><a href="/" aria-label="Previous">
                    <span aria-hidden="true">ğŸ ˜  </span>
                </a>YAYIN</h5>
                <h5><b>Pano Durumu: </b> <span id="connectionStatus">BaÄŸlÄ±</span>
                    (<span id="liveStatus">CanlÄ± yayÄ±n yapÄ±lmÄ±yor</span>)</h5>
                <input style="opacity: 0;position: absolute;">
                <input type="password" style="opacity: 0;position: absolute;">
                <input type="hidden" name="id" value="{{board.id}}">
                <div class="form-group">
                    <label for="rtmpUrl">RTMP Sunucu URL'si</label>
                    <input autocomplete="off" type="text" required minlength="2" class="form-control"
                           id="rtmpUrl"
                           name="rtmpUrl">
                </div>
                <div class="form-group">
                    <label for="rtmpKey">AkÄ±ÅŸ AdÄ±/AnahtarÄ±</label>
                    <input autocomplete="new-password" type="password" value="" class="form-control"
                           id="rtmpKey"
                           name="rtmpKey">
                </div>

                <button class="btn btn-danger" id="liveButton">YayÄ±nÄ± BaÅŸlat</button>

            </div>
        </div>
    </div>
    <div class="col-md-12 mt-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><a href="/" aria-label="Previous">
                    <span aria-hidden="true">ğŸ ˜  </span>
                </a>'{{board.title}}' AdlÄ± Panoyu DÃ¼zenle</h5>


                <form action="/board/edit" method="post">
                    <input type="hidden" name="id" value="{{board.id}}">
                    <div class="form-group">
                        <label for="title">BaÅŸlÄ±k</label>
                        <input value="{{board.title}}" type="text" required minlength="2" class="form-control"
                               id="title"
                               name="title">
                    </div>


                    <button type="submit" class="btn btn-primary">Kaydet</button>
                    <a href="/board/delete/{{board.id}}" class="btn btn-danger">Panoyu Sil</a>
                </form>

            </div>
        </div>
    </div>

</div>
<script>
    var id = {{board.id}};
    var isLive = false;
    var clientCallback = function (clients) {
        if (id in clients) {
            $('#connectionStatus').html('BaÄŸlÄ±');
            $('#liveButton').attr('disabled', false);
        } else {
            $('#connectionStatus').html('BaÄŸlÄ± deÄŸil');
            isLive = false;
            $('#liveButton').html('YayÄ±nÄ± BaÅŸlat');
            $('#liveStatus').html('CanlÄ± yayÄ±n yapÄ±lmÄ±yor.');
            $('#liveButton').attr('disabled', true);
        }
    }
    var statusCallback = function (params) {
        if (params.status == "live") {
            isLive = true;
            $('#liveStatus').html('CanlÄ± yayÄ±n baÅŸladÄ± !');
            $('#liveButton').html('YayÄ±nÄ± Durdur');
        } else if (params.status == "not_live") {
            isLive = false;
            $('#liveButton').html('YayÄ±nÄ± BaÅŸlat');
            $('#liveStatus').html('CanlÄ± yayÄ±n yapÄ±lmÄ±yor.');
        }
    }

    $('#liveButton').click(function () {
        var url = $('#rtmpUrl').val();
        var key = $('#rtmpKey').val();
        if(url==""){
            alert('LÃ¼tfen adresi yazÄ±n!');
            return;
        }
        if(isLive){
            sendToSocket('stopLive', {'userId': id});
        }else{
            sendToSocket('startLive', {'userId': id,"url":(url+'/'+key)});
        }
    });


</script>